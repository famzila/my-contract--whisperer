<div class="py-8 px-4 sm:px-6 lg:px-8">
  <div class="max-w-3xl mx-auto">
    <div class="flex justify-center mb-8">
      <div class="security-badge">
        <lucide-icon [img]="LockIcon" class="security-badge-icon"></lucide-icon>
        <span>{{ 'upload.privateSecure' | translate }}</span>
      </div>
    </div>

    <!-- Header -->
    <div class="text-center mb-4">
      <h2 class="text-hero pb-4">
        {{ 'upload.title' | translate }}
      </h2>
      <p class="text-xl text-slate-600 dark:text-slate-400 mb-4">
        {{ 'upload.subtitle' | translate }}
      </p>
      <p class="text-muted">
        {{ 'upload.details' | translate }}
      </p>
    </div>

    <!-- Mode Switcher -->
    <div class="mode-switcher">
      <div class="mode-switcher-container">
        <button
          (click)="setMode('file')"
          [class.mode-switcher-button-active]="mode() === 'file'"
          [class.mode-switcher-button-inactive]="mode() !== 'file'"
          class="mode-switcher-button"
        >
          <lucide-icon [img]="FileTextIcon" class="mode-switcher-icon"></lucide-icon>
          {{ 'upload.uploadFile' | translate }}
        </button>
        <button
          (click)="setMode('text')"
          [class.mode-switcher-button-active]="mode() === 'text'"
          [class.mode-switcher-button-inactive]="mode() !== 'text'"
          class="mode-switcher-button"
        >
          <lucide-icon [img]="EditIcon" class="mode-switcher-icon"></lucide-icon>
          {{ 'upload.pasteText' | translate }}
        </button>
      </div>
    </div>

    <!-- Download Progress Notice (shared for both file and text modes) -->
    @if (contractStore.shouldShowDownloadNotice()) {
    <div class="mb-6">
      <app-notice
        type="loading"
        [titleKey]="'upload.downloadingModel'"
        [message]="'upload.downloadProgress' | translate: {progress: contractStore.modelDownloadProgress() ?? 0}"
      >
        <div class="mt-3">
          <div class="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-2.5 overflow-hidden">
            <div
              class="h-full bg-gradient-to-r from-emerald-500 via-emerald-600 to-teal-600 dark:from-emerald-400 dark:via-emerald-500 dark:to-teal-500 rounded-full transition-all duration-300 ease-out"
              [style.width.%]="contractStore.modelDownloadProgress() ?? 0"
            ></div>
          </div>
          <p class="text-xs text-slate-600 dark:text-slate-400 mt-1.5 text-center">
            {{ contractStore.modelDownloadProgress() ?? 0 }}%
          </p>
        </div>
      </app-notice>
    </div>
    }

    <!-- Error Message -->
    @if (contractStore.uploadError() || contractStore.analysisError()) {
    <app-notice
      type="error"
      [icon]="TriangleAlertIcon"
      titleKey="common.error"
      [messageKey]="errorMessageKey()"
      [message]="errorMessage()"
      class="mb-6"
    >
      @if (shouldShowWaitlist()) {
      <div class="mt-2 space-y-3">
        <p class="text-sm text-red-700 dark:text-red-300 rtl:text-right ltr:text-left">
          {{ 'errors.waitlistGeneric' | translate }}
        </p>
        <div class="flex justify-end rtl:justify-start">
          <app-button
            (clicked)="openWaitlist()"
            variant="secondary"
            size="sm"
            [text]="'errors.joinWaitlist' | translate"
            [icon]="MailIcon"
          >
          </app-button>
        </div>
      </div>
      }
    </app-notice>

    }

    <!-- Chrome AI Availability Notice -->
    @if (showChromeAiNotice()) {
    <app-notice
      type="warning"
      [icon]="LightbulbIcon"
      titleKey="analysis.chromeAiNotAvailable"
      messageKey="analysis.chromeAiNotAvailableMessage"
      class="mb-6"
    >
    </app-notice>
    }

    <!-- Offline & AI Unavailable Notice -->
    @if (onboardingStore.isAnalysisDisabled()) {
    <app-notice
      type="error"
      [icon]="TriangleAlertIcon"
      titleKey="upload.offlineUnavailableTitle"
      messageKey="upload.offlineUnavailable"
      class="mb-6"
    >
    </app-notice>
    }

    <!-- File Upload Mode -->
    @if (mode() === 'file') {
    <div class="upload-card">
      <div
        (drop)="onFileDrop($event)"
        (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)"
        [class.upload-area-dragging]="isDragging()"
        class="upload-area"
      >
        @if (contractStore.isLoading() && !contractStore.shouldShowDownloadNotice()) {
        <div class="py-8">
          <div class="loading-spinner"></div>
          <p class="loading-text">{{ 'upload.processingContract' | translate }}</p>
        </div>
        } @else if (contractStore.isLoading() && contractStore.shouldShowDownloadNotice()) {
        <div class="py-8">
          <div class="loading-spinner"></div>
          <p class="loading-text">{{ 'upload.downloadingModel' | translate }}</p>
          <p class="text-sm text-slate-600 dark:text-slate-400 mt-2">
            {{ 'upload.downloadProgress' | translate: {progress: contractStore.modelDownloadProgress() ?? 0} }}
          </p>
        </div>
        } @else {
        <div class="flex justify-center mb-6 float-animation">
          <div class="upload-icon-container">
            <lucide-icon [img]="UploadIcon" class="upload-icon"></lucide-icon>
          </div>
        </div>
        <h3 class="upload-title">
          {{ 'upload.dropHere' | translate }}
        </h3>
        <p class="upload-subtitle">
          {{ 'upload.orClickBrowse' | translate }}
        </p>
        <input
          type="file"
          (change)="onFileSelected($event)"
          accept=".txt,.pdf,.docx"
          class="hidden"
          #fileInput
        />
        <app-button
          (clicked)="fileInput.click()"
          [icon]="UploadIcon"
          [text]="'upload.chooseFile' | translate"
          variant="primary"
          size="md"
          [rounded]="'lg'"
          [disabled]="onboardingStore.isAnalysisDisabled()"
        ></app-button>
        <p class="upload-formats">
          {{ 'upload.supportedFormats' | translate }}
        </p>
        }
      </div>
    </div>
    }

    <!-- Text Input Mode -->
    @if (mode() === 'text') {
    <div class="upload-card">
      <form (ngSubmit)="onTextSubmit()">
        <div class="mb-4">
          <label for="contract-text" class="form-label">
            {{ 'upload.contractText' | translate }}
          </label>
          <textarea
            id="contract-text"
            [(ngModel)]="contractText"
            name="contractText"
            rows="10"
            [placeholder]="'upload.pastePlaceholder' | translate"
            class="form-textarea"
            [disabled]="contractStore.isLoading()"
          ></textarea>
        </div>

        <!-- Stats -->
        @if (contractText()) {
        <div class="stats-container">
          <div class="flex items-center gap-2">
            <lucide-icon [img]="BarChart3Icon" class="stats-icon"></lucide-icon>
            <span>{{ wordCount }} {{ 'common.words' | translate }}</span>
          </div>
          <div class="flex items-center gap-2">
            <lucide-icon [img]="ClockIcon" class="stats-icon"></lucide-icon>
            <span>~{{ readingTime }} {{ 'common.minRead' | translate }}</span>
          </div>
        </div>
        }

        <!-- Submit Button -->
        <app-button
          type="submit"
          [disabled]="
            contractStore.isLoading() ||
            !contractText().trim() ||
            onboardingStore.isAnalysisDisabled()
          "
          [loading]="contractStore.isLoading() && !contractStore.shouldShowDownloadNotice()"
          variant="primary"
          [fullWidth]="true"
          [icon]="SparklesIcon"
          [text]="
            contractStore.shouldShowDownloadNotice()
              ? ('upload.downloadingModel' | translate)
              : contractStore.isLoading()
              ? ('upload.processing' | translate)
              : ('upload.analyzeContract' | translate)
          "
          [loadingText]="contractStore.shouldShowDownloadNotice() ? ('upload.downloadingModel' | translate) : ('upload.processing' | translate)"
        >
        </app-button>
      </form>
    </div>
    }

    <!-- Help Section -->
    <div class="help-section">
      <p class="help-text">{{ 'upload.needHelp' | translate }}</p>
      <div class="help-links">
        <app-button
          (clicked)="viewSampleContract()"
          variant="link"
          size="sm"
          [text]="'upload.viewSample' | translate"
          [icon]="BookOpenIcon"
        >
        </app-button>
        <app-button
          (clicked)="showHowItWorks()"
          variant="link"
          size="sm"
          [text]="'upload.howItWorks' | translate"
          [icon]="HelpCircleIcon"
        >
        </app-button>
        <app-button
          (clicked)="showPrivacyPolicy()"
          variant="link"
          size="sm"
          [text]="'upload.privacyPolicy' | translate"
          [icon]="ShieldIcon"
        >
        </app-button>
        <app-button
          (clicked)="showFaq()"
          variant="link"
          size="sm"
          [text]="'upload.faq' | translate"
          [icon]="HelpCircleIcon"
        >
        </app-button>
      </div>
    </div>
  </div>
</div>
