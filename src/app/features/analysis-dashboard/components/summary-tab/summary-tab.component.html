@if (isLoading()) {
<div>
  <app-tab-header
    [title]="'analysis.summary.title' | translate"
    [subtitle]="'analysis.summary.subtitle' | translate"
    [icon]="ClipboardIcon"
    iconBgClass="bg-blue-100 dark:bg-blue-900"
    iconColorClass="text-blue-600 dark:text-blue-400"
  >
  </app-tab-header>

  @if (isRetrying()) {
  <app-notice
    type="loading"
    [title]="
      ('analysis.retrying' | translate) +
      ' (' +
      ('analysis.attempt' | translate) +
      ' ' +
      retryCount() +
      '/3' +
      ')'
    "
    [message]="'analysis.retryMessage' | translate"
  ></app-notice>
  }

  <app-skeleton-loader
    type="list"
    [items]="5"
    listItemPadding="p-1"
    [loadingText]="'analysis.loading.summary' | translate"
  >
  </app-skeleton-loader>
</div>
} @else if (summary() === null) {
<div>
  <app-notice
    type="error"
    [title]="'analysis.summary.title' | translate"
    [message]="'analysis.summary.extractionError' | translate"
  ></app-notice>
</div>
} @else if (summary()) {

<app-tab-header
  [title]="'analysis.summary.title' | translate"
  [subtitle]="'analysis.summary.subtitle' | translate"
  [icon]="ClipboardIcon"
  iconBgClass="bg-blue-100 dark:bg-blue-900"
  iconColorClass="text-blue-600 dark:text-blue-400"
>
</app-tab-header>

@if (perspectiveContext()) {
<app-notice
  type="info"
  [icon]="ViewIcon"
  [titleKey]="perspectiveContext()!.titleKey"
  [messageKey]="perspectiveContext()!.messageKey"
></app-notice>
}

<div class="space-y-6">
  <!-- Parties -->
  <div class="pb-6 border-b border-divider">
    <h3 class="mb-3 flex items-center gap-2">
      <lucide-icon [name]="UsersIcon" class="w-5 h-5 text-blue-600 dark:text-blue-400"></lucide-icon>
      {{ 'analysis.summary.parties' | translate }}
    </h3>
    <p class="text-body">{{ summary()?.parties || ('common.notAvailable' | translate) }}</p>
  </div>

  <!-- Role -->
  <div class="pb-6 border-b border-divider">
    <h3 class="mb-3 flex items-center gap-2">
      <lucide-icon [name]="BriefcaseIcon" class="w-5 h-5 text-green-600 dark:text-green-400"></lucide-icon>
      {{ 'analysis.summary.roleRelationship' | translate }}
    </h3>
    <p class="text-body">{{ summary()?.role || ('common.notAvailable' | translate) }}</p>
  </div>

  <!-- Responsibilities -->
  @if (summary()?.responsibilities && summary()!.responsibilities!.length > 0) {
  <div class="pb-6 border-b border-divider">
    <h3 class="mb-3 flex items-center gap-2">
      <lucide-icon [name]="ClipboardIcon" class="w-5 h-5 text-blue-600 dark:text-blue-400"></lucide-icon>
      {{ 'analysis.summary.keyResponsibilities' | translate }}
    </h3>
    <ul class="list-disc list-inside space-y-1 text-body">
      @for (resp of summary()?.responsibilities || []; track $index) {
      <li>{{ resp }}</li>
      }
    </ul>
  </div>
  }

  <!-- Compensation -->
  <div class="pb-6 border-b border-divider">
    <h3 class="mb-3 flex items-center gap-2">
      <lucide-icon [name]="DollarSignIcon" class="w-5 h-5 text-green-600 dark:text-green-400"></lucide-icon>
      {{ 'analysis.summary.compensationBenefits' | translate }}
    </h3>
    <div class="space-y-2 text-body">
      @if (summary()?.compensation?.baseSalary) {
      <p>
        <strong>{{ 'analysis.summary.baseSalary' | translate }}:</strong> ${{
          summary()?.compensation?.baseSalary | number
        }}
      </p>
      } @if (summary()?.compensation?.bonus) {
      <p>
        <strong>{{ 'analysis.summary.bonus' | translate }}:</strong>
        {{ summary()?.compensation?.bonus }}
      </p>
      } @if (summary()?.compensation?.equity) {
      <p>
        <strong>{{ 'analysis.summary.equity' | translate }}:</strong>
        {{ summary()?.compensation?.equity }}
      </p>
      } @if (summary()?.compensation?.other) {
      <p>
        <strong>{{ 'analysis.summary.other' | translate }}:</strong>
        {{ summary()?.compensation?.other }}
      </p>
      }
    </div>
    @if (summary()?.benefits && summary()?.benefits!.length > 0) {
    <ul class="list-disc list-inside space-y-1 text-body mt-3">
      @for (benefit of summary()?.benefits || []; track $index) {
      <li>{{ benefit }}</li>
      }
    </ul>
    }
  </div>
  <!-- Termination -->
  <div class="pb-6 border-b border-divider">
    <h3 class="mb-3 flex items-center gap-2">
      <lucide-icon [name]="DoorOpenIcon" class="w-5 h-5 text-red-600 dark:text-red-400"></lucide-icon>
      {{ 'analysis.summary.terminationConditions' | translate }}
    </h3>
    <div class="space-y-2 text-body">
      @if (summary()?.termination?.atWill) {
      <p>
        <strong>{{ 'analysis.summary.atWill' | translate }}:</strong>
        {{ summary()?.termination?.atWill }}
      </p>
      } @if (summary()?.termination?.forCause) {
      <p>
        <strong>{{ 'analysis.summary.forCause' | translate }}:</strong>
        {{ summary()?.termination?.forCause }}
      </p>
      } @if (summary()?.termination?.severance) {
      <p>
        <strong>{{ 'analysis.summary.severance' | translate }}:</strong>
        {{ summary()?.termination?.severance }}
      </p>
      }
    </div>
  </div>

  <!-- Restrictions -->
  <div class="pb-6">
    <h3 class="mb-3 flex items-center gap-2">
      <lucide-icon [name]="ShieldIcon" class="w-5 h-5 text-red-600 dark:text-red-400"></lucide-icon>
      {{ 'analysis.summary.restrictions' | translate }}
    </h3>
    <div class="space-y-2 text-body">
      @if (summary()?.restrictions?.confidentiality) {
      <p>
        <strong>{{ 'analysis.summary.confidentiality' | translate }}:</strong>
        {{ summary()?.restrictions?.confidentiality }}
      </p>
      } @if (summary()?.restrictions?.nonCompete) {
      <p>
        <strong>{{ 'analysis.summary.nonCompete' | translate }}:</strong>
        {{ summary()?.restrictions?.nonCompete }}
      </p>
      } @if (summary()?.restrictions?.nonSolicitation) {
      <p>
        <strong>{{ 'analysis.summary.nonSolicitation' | translate }}:</strong>
        {{ summary()?.restrictions?.nonSolicitation }}
      </p>
      } @if (summary()?.restrictions?.other) {
      <p>
        <strong>{{ 'analysis.summary.other' | translate }}:</strong>
        {{ summary()?.restrictions?.other }}
      </p>
      }
    </div>
  </div>
</div>
} @else {

<div class="text-empty-state">
  <lucide-icon [name]="FileXIcon" class="w-16 h-16 mx-auto mb-4 text-gray-400 dark:text-gray-500"></lucide-icon>
  <p>{{ 'analysis.summary.noData' | translate }}</p>
</div>
}
